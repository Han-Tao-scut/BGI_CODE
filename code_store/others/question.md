### Q:

已知7625条序列跑checkv时间大概是1-1.2h， 资源是2CPU，8G。现在我要把在all_vOTU.fasta里但是不在LabGovImgvrBGI里的序列（按名称ID）选出来跑checkv这个流程，你设计一个方案怎么能在云平台上经济且快速地拿到结果。

![img](https://bitbucket.org/berkeleylab/checkv/raw/657fde9b1c696185a399456fbcbb4ca82066abb6/pipeline.png)

### **idea：**

#### 去冗余，减少数据样本,减少数据库

checkv用于评估样本的完整性，需要进行大量的数据比对，所以首先我们需要考虑在比对数据库和我们输入的序列是否需要进行优化：

1. **去除冗余序列**

   这里我不好评判聚类的cutoff，0.9？因为我们的最终目的是为了评判样本的完整性，所以我认为还是1.0可能更好，单纯去除掉重复的值，especially，如果是DNA，记得去除反向互补序列，不过如果RNA是方向互补，会是什么情况

2. **减少比对数据库**

   **A.**我们如果已经知道样本的大致分布，减少数据库的量，将会大幅度减少比对时间

   **B.**比如我们可以先聚类，然后根据聚类选择代表的样本进行基因注释，大致摸清这一类的样本需要哪些数据库（但是我认为这样可能会导致总的流程时间增长，而且必然导致注释信息的丢失，宿主污染的加重，所以可能还是需要balance)

   **C.**相对而言，我觉得下面的流程可能会加速比对时间，先将去冗余后的序列仅仅进行微生物库的基因注释，如果发现存在宿主污染，进行病毒的基因注释，拆分，如果无，进入B，评估完整性

   #### **并行/wdl**

   **A.并行**

   财大气粗的老爷可以看这步，我们直接申请大节点，然后并行跑数据，不过仅限于富爷，云平台你花多少钱，现在老板看的清清楚楚，而且最要命的是云平台又贵又难用；而且可以看到，cpu内存和价格可不是线性变化，抢钱！！！

   ![image-20241118161811197](C:\Users\hantao\AppData\Roaming\Typora\typora-user-images\image-20241118161811197.png)

    **B.wdl**

   像我们这种拿最低工资的牛马，怎么省钱呢？开n个2cpu，8gb的实例不就行了，主打省钱，费用线性增长,越多越省；不过牛马主打怎么懒怎么来，wdl了解一下，请查看并行的运行，相当于他帮你开了很多ECS,或者输出的合并，perfect。

   ![img](https://img2018.cnblogs.com/blog/1676005/201908/1676005-20190802140234605-754822168.png)





#### 